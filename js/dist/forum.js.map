{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@justoverclock/stats/webpack/bootstrap","webpack://@justoverclock/stats/webpack/runtime/compat get default export","webpack://@justoverclock/stats/webpack/runtime/define property getters","webpack://@justoverclock/stats/webpack/runtime/hasOwnProperty shorthand","webpack://@justoverclock/stats/external root \"flarum.core.compat['common/app']\"","webpack://@justoverclock/stats/./src/common/index.ts","webpack://@justoverclock/stats/external root \"flarum.core.compat['forum/app']\"","webpack://@justoverclock/stats/external root \"flarum.core.compat['forum/components/UserCard']\"","webpack://@justoverclock/stats/external root \"flarum.core.compat['common/extend']\"","webpack://@justoverclock/stats/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@justoverclock/stats/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@justoverclock/stats/external root \"flarum.core.compat['common/Component']\"","webpack://@justoverclock/stats/external root \"flarum.core.compat['common/components/Modal']\"","webpack://@justoverclock/stats/external root \"flarum.core.compat['common/utils/Stream']\"","webpack://@justoverclock/stats/./src/forum/components/EditModal/EditModal.tsx","webpack://@justoverclock/stats/external root \"flarum.core.compat['common/components/Tooltip']\"","webpack://@justoverclock/stats/./src/forum/components/SingleUserStat.tsx","webpack://@justoverclock/stats/./src/forum/components/UserStats.tsx","webpack://@justoverclock/stats/./src/forum/components/StatsModal/StatsModal.tsx","webpack://@justoverclock/stats/./src/forum/components/UserStatsPopover.tsx","webpack://@justoverclock/stats/./src/forum/index.tsx"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/app'];","import app from 'flarum/common/app';\n\napp.initializers.add('justoverclock/stats', () => {\n  console.log('[justoverclock/stats] Hello, forum and admin!');\n});\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/UserCard'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","function _setPrototypeOf(t, e) {\n  return _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) {\n    return t.__proto__ = e, t;\n  }, _setPrototypeOf(t, e);\n}\nexport { _setPrototypeOf as default };","import setPrototypeOf from \"./setPrototypeOf.js\";\nfunction _inheritsLoose(t, o) {\n  t.prototype = Object.create(o.prototype), t.prototype.constructor = t, setPrototypeOf(t, o);\n}\nexport { _inheritsLoose as default };","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/Component'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Modal'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/utils/Stream'];","import Modal, {IInternalModalAttrs} from \"flarum/common/components/Modal\";\nimport Mithril from \"mithril\";\nimport {UserStat} from \"../types\";\nimport User from \"flarum/common/models/User\";\nimport Stream from \"flarum/common/utils/Stream\";\nimport app from 'flarum/forum/app'\n\ninterface StatModalAttrs extends IInternalModalAttrs {\n  stat: UserStat\n  baseStat: any\n  user: User\n  editUserStat: (id: string | number, newValue: string | number) => void\n}\n\nexport default class EditModal extends Modal<StatModalAttrs> {\n  value = Stream('')\n  className(): string {\n    return 'stat-modal-edit';\n  }\n\n  title(): Mithril.Children {\n    return `${this.attrs.baseStat.attributes.name}`;\n  }\n\n  content(): Mithril.Children {\n    const statName = this.attrs.baseStat.attributes.name\n    const username = this.attrs.user.displayName()\n    return (\n      <div className=\"edit-stat-modal-container\">\n        <h3>\n          Set \"{statName}\" for {username}\n        </h3>\n        <input\n          className=\"FormControl\"\n          name={statName}\n          placeholder={app.translator.trans('justoverclock-stats.forum.editStatInputPlaceholder')}\n          type=\"text\"\n          oninput={(e: { target: { value: any } }) => this.value(e.target.value)}\n        />\n        <button\n          onclick={(e: { preventDefault: () => void }) => {\n            e.preventDefault();\n            this.attrs.editUserStat(this.attrs.stat.id, this.value());\n            this.hide()\n          }}\n          className=\"Button Button--primary\"\n        >\n          {app.translator.trans('justoverclock-stats.forum.save')}\n        </button>\n      </div>\n    );\n  }\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Tooltip'];","import Component, { ComponentAttrs } from 'flarum/common/Component';\nimport Mithril from 'mithril';\nimport Tooltip from 'flarum/common/components/Tooltip';\n\nexport interface SingleUserStatAttrs {\n  name: string;\n  img: string;              // 恢复为必填\n  alt: string;\n  value: string | number;\n  onclick?: () => void;\n}\n\nexport default class SingleUserStat extends Component<SingleUserStatAttrs> {\n  oninit(vnode: Mithril.Vnode<ComponentAttrs, this>) {\n    super.oninit(vnode);\n  }\n\n  view(vnode: Mithril.Vnode<ComponentAttrs, this>): Mithril.Children {\n    return (\n      <div\n        className=\"stat\"\n        onclick={() => {\n          this.attrs.onclick ? this.attrs.onclick() : null;\n        }}\n      >\n        <div className=\"stat-value\">\n          <Tooltip text={this.attrs.name}>\n            <img src={this.attrs.img} alt={this.attrs.alt} />\n          </Tooltip>\n          <p className=\"stat-desc\">{this.attrs.name}</p>\n          <p className=\"statvalue\">{String(this.attrs.value)}</p>\n        </div>\n      </div>\n    );\n  }\n}\n\n","// @ts-nocheck\nimport Component, { ComponentAttrs } from 'flarum/common/Component';\nimport Mithril from 'mithril';\nimport app from 'flarum/forum/app';\nimport User from 'flarum/common/models/User';\nimport { ApiResponse, BaseStat, UserStat } from './types';\nimport EditModal from './EditModal/EditModal';\nimport SingleUserStat from './SingleUserStat';\n\ninterface UserStatsAttrs {\n  user: User;\n}\n\nconst svg = (s: string) => `data:image/svg+xml;utf8,${encodeURIComponent(s)}`;\n\n// 统一视觉：与按钮同色系 #4D698E\nconst IMG_MONEY = (baseUrl: string) =>\n  app.forum.attribute('justoverclock-stats.moneyImg') ||\n  `${baseUrl}/assets/extensions/justoverclock-stats/money1.png`;\n\nconst IMG_TOPICS = svg(\n  `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\">\n     <rect x=\"3\" y=\"4\" width=\"18\" height=\"14\" rx=\"2\" ry=\"2\" fill=\"#4D698E\"/>\n     <path fill=\"#fff\" d=\"M6 8h12v2H6zM6 12h9v2H6z\"/>\n   </svg>`\n);\n\nconst IMG_REPLIES = svg(\n  `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\">\n     <path fill=\"#4D698E\" d=\"M4 3h16a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H10l-5 4v-4H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z\"/>\n     <path fill=\"#fff\" d=\"M7 8h10v2H7zM7 11h7v2H7z\"/>\n   </svg>`\n);\n\nconst IMG_FOLLOWING = svg(\n  `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\">\n     <circle cx=\"9\" cy=\"8\" r=\"3.5\" fill=\"#4D698E\"/>\n     <path fill=\"#4D698E\" d=\"M3 19a6 6 0 0 1 12 0v1H3z\"/>\n     <path fill=\"#4D698E\" d=\"M16 7h4l-1.5-1.5L20 4l3 3-3 3-1.5-1.5L20 7h-4z\"/>\n   </svg>`\n);\n\nconst IMG_FOLLOWERS = svg(\n  `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\">\n     <circle cx=\"8\" cy=\"8\" r=\"3.2\" fill=\"#4D698E\"/>\n     <circle cx=\"16\" cy=\"9\" r=\"2.6\" fill=\"#4D698E\"/>\n     <path fill=\"#4D698E\" d=\"M2.5 19a5.5 5.5 0 0 1 11 0v1h-11zM12.8 19c.2-1.9 1.6-3.6 3.9-4.3 2.3.7 3.7 2.4 3.9 4.3v1h-7.8z\"/>\n   </svg>`\n);\n\nconst IMG_EXP = svg(\n  `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\">\n     <rect x=\"4\" y=\"14\" width=\"3\" height=\"6\" fill=\"#4D698E\"/>\n     <rect x=\"9.5\" y=\"11\" width=\"3\" height=\"9\" fill=\"#4D698E\"/>\n     <rect x=\"15\" y=\"7\" width=\"3\" height=\"13\" fill=\"#4D698E\"/>\n     <path fill=\"#4D698E\" d=\"M5 6l2-2 4 4 6-6 2 2-8 8z\"/>\n   </svg>`\n);\n\nexport default class UserStats extends Component<UserStatsAttrs> {\n  public userStat: ApiResponse | null = null;\n\n  oninit(vnode: Mithril.Vnode<ComponentAttrs, this>) {\n    super.oninit(vnode);\n    this.userStat = null;\n    this.getUserStat();\n  }\n\n  view(vnode: Mithril.Vnode<ComponentAttrs, this>): Mithril.Children {\n    if (!this.userStat) return <div></div>;\n\n    const { data } = this.attrs.user;\n    const a = (data && data.attributes) || {};\n    const has = (k: string) => Object.prototype.hasOwnProperty.call(a, k);\n    const baseUrl = app.forum.attribute('baseUrl');\n\n    // labels（可后续换成翻译键）\n    const moneyName = app.translator.trans('justoverclock-stats.forum.moneyName') || 'Money';\n    const topicsName = 'Topics';\n    const repliesName = 'Replies';\n    const followingName = 'Following';\n    const followersName = 'Followers';\n    const expName = 'EXP';\n\n    const canEditStats: boolean = !!a.canEditStats;\n\n    // 只读内建统计：存在即显示\n    const builtin: Array<{ name: string; value: number | string; img: string; alt: string }> = [];\n    if (has('money'))           builtin.push({ name: moneyName,  value: a.money ?? 0,              img: IMG_MONEY(baseUrl),   alt: moneyName });\n    if (has('discussionCount')) builtin.push({ name: topicsName, value: a.discussionCount ?? 0,    img: IMG_TOPICS,           alt: topicsName });\n    if (has('commentCount'))    builtin.push({ name: repliesName, value: a.commentCount ?? 0,      img: IMG_REPLIES,          alt: repliesName });\n    if (has('followingCount'))  builtin.push({ name: followingName, value: a.followingCount ?? 0,  img: IMG_FOLLOWING,        alt: followingName });\n    if (has('followerCount'))   builtin.push({ name: followersName, value: a.followerCount ?? 0,   img: IMG_FOLLOWERS,        alt: followersName });\n    if (has('exp'))             builtin.push({ name: expName, value: a.exp ?? 0,                   img: IMG_EXP,              alt: expName });\n\n    return (\n      <div className=\"show-stats-wrapper\">\n        <div className=\"user-stats-fe show-stats-container\">\n          {/* 内建只读项 */}\n          {builtin.map((it) => (\n            <SingleUserStat name={it.name} img={it.img} alt={it.alt} value={it.value} />\n          ))}\n\n          {/* 可编辑的自定义 BaseStats（保持原实现） */}\n          {this.userStat.data &&\n            this.userStat.data.map((stat: UserStat) => {\n              const baseStat: BaseStat | null | undefined =\n                this.userStat &&\n                this.userStat.included.find(\n                  (baseStat) => baseStat.id.toString() === stat.attributes.baseStatId.toString()\n                );\n              const imgPath = baseStat ? baseStat.attributes.img : '';\n\n              return (\n                <SingleUserStat\n                  name={baseStat?.attributes.name}\n                  img={imgPath}\n                  alt={baseStat?.attributes.name}\n                  value={stat.attributes.value}\n                  onclick={() => {\n                    canEditStats ? this.openEditModal(stat, baseStat, this.attrs.user) : null;\n                  }}\n                />\n              );\n            })}\n        </div>\n      </div>\n    );\n  }\n\n  openEditModal(stat: UserStat, baseStat: any, user: User) {\n    app.modal.show(EditModal, {\n      stat,\n      baseStat,\n      user,\n      editUserStat: this.editUserStat.bind(this),\n    });\n  }\n\n  editUserStat(id: string | number, newValue: string | number) {\n    app\n      .request({\n        method: 'PATCH',\n        url: `${app.forum.attribute('apiUrl')}/user-stats/${id}`,\n        body: {\n          data: {\n            attributes: {\n              value: Number(newValue),\n            },\n          },\n        },\n      })\n      .then(() => {\n        app.alerts.show({ type: 'success' }, app.translator.trans('justoverclock-stats.forum.successStatEdited'));\n      });\n  }\n\n  getUserStat() {\n    app\n      .request({\n        method: 'GET',\n        url: `${app.forum.attribute('apiUrl')}/user-stats/${this.attrs.user.data.id}`,\n      })\n      .then((res) => {\n        this.userStat = res as ApiResponse;\n        m.redraw();\n      });\n  }\n}\n","// @ts-nocheck\nimport Modal from \"flarum/common/components/Modal\";\nimport Mithril from \"mithril\";\nimport UserStats from \"../UserStats\";\n\nexport default class StatsModal extends Modal {\n  className(): string {\n    return 'stats-modal';\n  }\n\n  title(): Mithril.Children {\n    return ``;\n  }\n\n  content(): Mithril.Children {\n    return (\n      <div className=\"edit-stat-modal-container\">\n        <UserStats user={this.attrs.user} />\n      </div>\n    );\n  }\n}\n","// @ts-nocheck\nimport Component, {ComponentAttrs} from \"flarum/common/Component\";\nimport Mithril from \"mithril\";\nimport app from 'flarum/forum/app'\nimport StatsModal from \"./StatsModal/StatsModal\";\n\nexport default class UserStatsPopover extends Component {\n  oninit(vnode: Mithril.Vnode<ComponentAttrs, this>) {\n    super.oninit(vnode);\n  }\n\n\n  openModal() {\n    app.modal.show(StatsModal, { user: this.attrs.user })\n  }\n\n  view(vnode: Mithril.Vnode<ComponentAttrs, this>): Mithril.Children {\n    return (\n      <div className='stats-btn-popover'>\n        <div className='stats-svg' onclick={() => this.openModal()}>\n          <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 32 32\" id=\"statistic\">\n            <path fill=\"#4D698E\" d=\"M29,10V22a5.021,5.021,0,0,1-.3,1.7,5.084,5.084,0,0,1-1.99,2.51A5,5,0,0,1,24,27H8a5,5,0,0,1-5-5V10a5,5,0,0,1,.79-2.71A5.084,5.084,0,0,1,6.3,5.3,5.021,5.021,0,0,1,8,5H24A5,5,0,0,1,29,10Z\"></path>\n            <path fill=\"#4D698E\" d=\"M29,10V22a5.021,5.021,0,0,1-.3,1.7A4.788,4.788,0,0,1,27,24H11a5,5,0,0,1-5-5V7a4.788,4.788,0,0,1,.3-1.7A5.021,5.021,0,0,1,8,5H24A5,5,0,0,1,29,10Z\"></path>\n            <path fill=\"#4D698E\" d=\"M24,27H8a5.006,5.006,0,0,1-5-5V10A5.006,5.006,0,0,1,8,5H24a5.006,5.006,0,0,1,5,5V22A5.006,5.006,0,0,1,24,27ZM8,7a3,3,0,0,0-3,3V22a3,3,0,0,0,3,3H24a3,3,0,0,0,3-3V10a3,3,0,0,0-3-3Z\"></path>\n            <path fill=\"#fff\" d=\"M16 22.5A1.5 1.5 0 0114.5 21V11a1.5 1.5 0 013 0V21A1.5 1.5 0 0116 22.5zM10 22.5A1.5 1.5 0 018.5 21V15a1.5 1.5 0 013 0v6A1.5 1.5 0 0110 22.5zM22 22.5A1.5 1.5 0 0120.5 21V13a1.5 1.5 0 013 0v8A1.5 1.5 0 0122 22.5z\"></path>\n          </svg>\n        </div>\n      </div>\n    );\n  }\n}\n","// @ts-nocheck\nimport app from 'flarum/forum/app';\nimport UserCard from 'flarum/forum/components/UserCard';\nimport { extend } from 'flarum/common/extend';\nimport UserStats from \"./components/UserStats\";\nimport UserStatsPopover from \"./components/UserStatsPopover\";\n\napp.initializers.add('justoverclock/stats', () => {\n  /*extend(UserCard.prototype, 'view', function (vdom){\n    if (vdom.children && vdom.children.splice) {\n      vdom.children.splice(1,0, <UserStats user={this.attrs.user} />)\n    }\n  })*/\n  extend(UserCard.prototype, 'view', function (vnode) {\n    const avatarNode = vnode.children[0].children[0].children[1].children\n    console.log(avatarNode)\n    avatarNode.push(\n      <UserStatsPopover user={this.attrs.user} />\n    );\n  });\n});\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","flarum","core","compat","app","add","console","log","_setPrototypeOf","t","e","setPrototypeOf","bind","__proto__","_inheritsLoose","create","constructor","EditModal","_Modal","_this","_len","arguments","length","args","Array","_key","apply","concat","value","Stream","_proto","className","title","this","attrs","baseStat","attributes","name","content","_this2","statName","username","user","displayName","m","placeholder","trans","type","oninput","target","onclick","preventDefault","editUserStat","stat","id","hide","Modal","SingleUserStat","_Component","oninit","vnode","view","Tooltip","text","src","img","alt","String","Component","svg","s","encodeURIComponent","IMG_MONEY","baseUrl","attribute","IMG_TOPICS","IMG_REPLIES","IMG_FOLLOWING","IMG_FOLLOWERS","IMG_EXP","UserStats","userStat","getUserStat","_a$money","_a$discussionCount","_a$commentCount","_a$followingCount","_a$followerCount","_a$exp","data","has","k","moneyName","topicsName","repliesName","followingName","followersName","canEditStats","builtin","push","money","discussionCount","commentCount","followingCount","followerCount","exp","map","it","included","find","toString","baseStatId","imgPath","openEditModal","show","newValue","method","url","body","Number","then","_this3","res","redraw","StatsModal","UserStatsPopover","openModal","xmlns","viewBox","fill","extend","UserCard","avatarNode","children"],"sourceRoot":""}