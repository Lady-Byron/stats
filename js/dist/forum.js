(()=>{var t={n:o=>{var a=o&&o.__esModule?()=>o.default:()=>o;return t.d(a,{a}),a},d:(o,a)=>{for(var n in a)t.o(a,n)&&!t.o(o,n)&&Object.defineProperty(o,n,{enumerable:!0,get:a[n]})},o:(t,o)=>Object.prototype.hasOwnProperty.call(t,o)};(()=>{"use strict";const o=flarum.core.compat["common/app"];t.n(o)().initializers.add("justoverclock/stats",(function(){console.log("[justoverclock/stats] Hello, forum and admin!")}));const a=flarum.core.compat["forum/app"];var n=t.n(a);const e=flarum.core.compat["forum/components/UserCard"];var r=t.n(e);const s=flarum.core.compat["common/extend"];function i(t,o){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,o){return t.__proto__=o,t},i(t,o)}function u(t,o){t.prototype=Object.create(o.prototype),t.prototype.constructor=t,i(t,o)}const c=flarum.core.compat["common/Component"];var l=t.n(c);const f=flarum.core.compat["common/components/Modal"];var d=t.n(f);const p=flarum.core.compat["common/utils/Stream"];var v=t.n(p),h=function(t){function o(){for(var o,a=arguments.length,n=new Array(a),e=0;e<a;e++)n[e]=arguments[e];return(o=t.call.apply(t,[this].concat(n))||this).value=v()(""),o}u(o,t);var a=o.prototype;return a.className=function(){return"stat-modal-edit"},a.title=function(){return""+this.attrs.baseStat.attributes.name},a.content=function(){var t=this,o=this.attrs.baseStat.attributes.name,a=this.attrs.user.displayName();return m("div",{className:"edit-stat-modal-container"},m("h3",null,'Set "',o,'" for ',a),m("input",{className:"FormControl",name:o,placeholder:n().translator.trans("justoverclock-stats.forum.editStatInputPlaceholder"),type:"text",oninput:function(o){return t.value(o.target.value)}}),m("button",{onclick:function(o){o.preventDefault(),t.attrs.editUserStat(t.attrs.stat.id,t.value()),t.hide()},className:"Button Button--primary"},n().translator.trans("justoverclock-stats.forum.save")))},o}(d());const y=flarum.core.compat["common/components/Tooltip"];var b=t.n(y),S=function(t){function o(){return t.apply(this,arguments)||this}u(o,t);var a=o.prototype;return a.oninit=function(o){t.prototype.oninit.call(this,o)},a.view=function(){var t=this.attrs,o=t.name,a=t.icon,n=t.value,e=t.onclick;return m("div",{className:"stat",onclick:function(){return e&&e()}},m("div",{className:"stat-value"},m(b(),{text:o},m("i",{class:a,"aria-label":o,role:"img"})),m("p",{className:"stat-desc"},o),m("p",{className:"statvalue"},String(n))))},o}(l()),w=function(t){function o(){for(var o,a=arguments.length,n=new Array(a),e=0;e<a;e++)n[e]=arguments[e];return(o=t.call.apply(t,[this].concat(n))||this).userStat=null,o}u(o,t);var a=o.prototype;return a.oninit=function(o){t.prototype.oninit.call(this,o),this.userStat=null,this.getUserStat()},a.view=function(){var t,o,a,e,r,s=this;if(!this.userStat)return m("div",null);var i=this.attrs.user.data,u=i&&i.attributes||{},c=function(t){return Object.prototype.hasOwnProperty.call(u,t)},l=n().translator.trans("justoverclock-stats.forum.moneyName"),f=n().translator.trans("justoverclock-stats.forum.topics"),d=n().translator.trans("justoverclock-stats.forum.replies"),p=n().translator.trans("justoverclock-stats.forum.following"),v=n().translator.trans("justoverclock-stats.forum.followers"),h=!!u.canEditStats;return m("div",{className:"show-stats-wrapper"},m("div",{className:"user-stats-fe show-stats-container"},c("money")&&m(S,{name:l,icon:"fa-duotone fa-solid fa-coin-front",value:null!=(t=u.money)?t:0}),c("discussionCount")&&m(S,{name:f,icon:"fa-duotone fa-solid fa-message-smile",value:null!=(o=u.discussionCount)?o:0}),c("commentCount")&&m(S,{name:d,icon:"fa-duotone fa-solid fa-message-heart",value:null!=(a=u.commentCount)?a:0}),c("followingCount")&&m(S,{name:p,icon:"fa-duotone fa-solid fa-person-dress-fairy",value:null!=(e=u.followingCount)?e:0}),c("followerCount")&&m(S,{name:v,icon:"fa-duotone fa-solid fa-head-side-heart",value:null!=(r=u.followerCount)?r:0}),this.userStat.data&&this.userStat.data.map((function(t){var o=s.userStat&&s.userStat.included.find((function(o){return o.id.toString()===t.attributes.baseStatId.toString()})),a=(null==o?void 0:o.attributes.name)||"",n=t.attributes.value;return m(S,{name:a,icon:"fa-duotone fa-chart-simple",value:n,onclick:function(){h&&s.openEditModal(t,o,s.attrs.user)}})}))))},a.openEditModal=function(t,o,a){n().modal.show(h,{stat:t,baseStat:o,user:a,editUserStat:this.editUserStat.bind(this)})},a.editUserStat=function(t,o){n().request({method:"PATCH",url:n().forum.attribute("apiUrl")+"/user-stats/"+t,body:{data:{attributes:{value:Number(o)}}}}).then((function(){n().alerts.show({type:"success"},n().translator.trans("justoverclock-stats.forum.successStatEdited"))}))},a.getUserStat=function(){var t=this;n().request({method:"GET",url:n().forum.attribute("apiUrl")+"/user-stats/"+this.attrs.user.data.id}).then((function(o){t.userStat=o,m.redraw()}))},o}(l()),k=function(t){function o(){return t.apply(this,arguments)||this}u(o,t);var a=o.prototype;return a.className=function(){return"stats-modal"},a.title=function(){return""},a.content=function(){return m("div",{className:"edit-stat-modal-container"},m(w,{user:this.attrs.user}))},o}(d()),g=function(t){function o(){return t.apply(this,arguments)||this}u(o,t);var a=o.prototype;return a.oninit=function(o){t.prototype.oninit.call(this,o)},a.openModal=function(){n().modal.show(k,{user:this.attrs.user})},a.view=function(){var t=this;return m("div",{className:"stats-btn-popover",onclick:function(){return t.openModal()},"aria-label":"Open stats",role:"button",tabindex:"0",onkeydown:function(o){"Enter"!==o.key&&" "!==o.key||t.openModal()}},m("i",{class:"fa-duotone fa-solid fa-star-shooting","aria-hidden":"true"}))},o}(l());n().initializers.add("justoverclock/stats",(function(){(0,s.extend)(r().prototype,"view",(function(t){var o=t.children[0].children[0].children[1].children;console.log(o),o.push(m(g,{user:this.attrs.user}))}))}))})(),module.exports={}})();
//# sourceMappingURL=forum.js.map