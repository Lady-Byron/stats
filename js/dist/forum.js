(()=>{var t={n:a=>{var n=a&&a.__esModule?()=>a.default:()=>a;return t.d(n,{a:n}),n},d:(a,n)=>{for(var e in n)t.o(n,e)&&!t.o(a,e)&&Object.defineProperty(a,e,{enumerable:!0,get:n[e]})},o:(t,a)=>Object.prototype.hasOwnProperty.call(t,a)};(()=>{"use strict";const a=flarum.core.compat["common/app"];t.n(a)().initializers.add("justoverclock/stats",(function(){console.log("[justoverclock/stats] Hello, forum and admin!")}));const n=flarum.core.compat["forum/app"];var e=t.n(n);const r=flarum.core.compat["forum/components/UserCard"];var o=t.n(r);const s=flarum.core.compat["common/extend"];function i(t,a){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,a){return t.__proto__=a,t},i(t,a)}function l(t,a){t.prototype=Object.create(a.prototype),t.prototype.constructor=t,i(t,a)}const u=flarum.core.compat["common/Component"];var c=t.n(u);const p=flarum.core.compat["common/components/Modal"];var f=t.n(p);const v=flarum.core.compat["common/utils/Stream"];var h=t.n(v),d=function(t){function a(){for(var a,n=arguments.length,e=new Array(n),r=0;r<n;r++)e[r]=arguments[r];return(a=t.call.apply(t,[this].concat(e))||this).value=h()(""),a}l(a,t);var n=a.prototype;return n.className=function(){return"stat-modal-edit"},n.title=function(){return""+this.attrs.baseStat.attributes.name},n.content=function(){var t=this,a=this.attrs.baseStat.attributes.name,n=this.attrs.user.displayName();return m("div",{className:"edit-stat-modal-container"},m("h3",null,'Set "',a,'" for ',n),m("input",{className:"FormControl",name:a,placeholder:e().translator.trans("justoverclock-stats.forum.editStatInputPlaceholder"),type:"text",oninput:function(a){return t.value(a.target.value)}}),m("button",{onclick:function(a){a.preventDefault(),t.attrs.editUserStat(t.attrs.stat.id,t.value()),t.hide()},className:"Button Button--primary"},e().translator.trans("justoverclock-stats.forum.save")))},a}(f());const g=flarum.core.compat["common/components/Tooltip"];var w=t.n(g),y=function(t){function a(){return t.apply(this,arguments)||this}l(a,t);var n=a.prototype;return n.oninit=function(a){t.prototype.oninit.call(this,a)},n.view=function(t){var a=this;return m("div",{className:"stat",onclick:function(){a.attrs.onclick&&a.attrs.onclick()}},m("div",{className:"stat-value"},m(w(),{text:this.attrs.name},m("img",{src:this.attrs.img,alt:this.attrs.alt})),m("p",{className:"stat-desc"},this.attrs.name),m("p",{className:"statvalue"},String(this.attrs.value))))},a}(c()),b=function(t){return"data:image/svg+xml;utf8,"+encodeURIComponent(t)},x=function(t){return e().forum.attribute("justoverclock-stats.moneyImg")||t+"/assets/extensions/justoverclock-stats/money1.png"},S=b('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\n     <rect x="3" y="4" width="18" height="14" rx="2" ry="2" fill="#4D698E"/>\n     <path fill="#fff" d="M6 8h12v2H6zM6 12h9v2H6z"/>\n   </svg>'),M=b('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\n     <path fill="#4D698E" d="M4 3h16a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H10l-5 4v-4H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z"/>\n     <path fill="#fff" d="M7 8h10v2H7zM7 11h7v2H7z"/>\n   </svg>'),E=b('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\n     <circle cx="9" cy="8" r="3.5" fill="#4D698E"/>\n     <path fill="#4D698E" d="M3 19a6 6 0 0 1 12 0v1H3z"/>\n     <path fill="#4D698E" d="M16 7h4l-1.5-1.5L20 4l3 3-3 3-1.5-1.5L20 7h-4z"/>\n   </svg>'),A=b('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\n     <circle cx="8" cy="8" r="3.2" fill="#4D698E"/>\n     <circle cx="16" cy="9" r="2.6" fill="#4D698E"/>\n     <path fill="#4D698E" d="M2.5 19a5.5 5.5 0 0 1 11 0v1h-11zM12.8 19c.2-1.9 1.6-3.6 3.9-4.3 2.3.7 3.7 2.4 3.9 4.3v1h-7.8z"/>\n   </svg>'),N=b('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\n     <rect x="4" y="14" width="3" height="6" fill="#4D698E"/>\n     <rect x="9.5" y="11" width="3" height="9" fill="#4D698E"/>\n     <rect x="15" y="7" width="3" height="13" fill="#4D698E"/>\n     <path fill="#4D698E" d="M5 6l2-2 4 4 6-6 2 2-8 8z"/>\n   </svg>'),D=function(t){function a(){for(var a,n=arguments.length,e=new Array(n),r=0;r<n;r++)e[r]=arguments[r];return(a=t.call.apply(t,[this].concat(e))||this).userStat=null,a}l(a,t);var n=a.prototype;return n.oninit=function(a){t.prototype.oninit.call(this,a),this.userStat=null,this.getUserStat()},n.view=function(t){var a,n,r,o,s,i,l=this;if(!this.userStat)return m("div",null);var u=this.attrs.user.data,c=u&&u.attributes||{},p=function(t){return Object.prototype.hasOwnProperty.call(c,t)},f=e().forum.attribute("baseUrl"),v=e().translator.trans("justoverclock-stats.forum.moneyName")||"Money",h="Topics",d="Replies",g="Following",w="Followers",b=!!c.canEditStats,D=[];return p("money")&&D.push({name:v,value:null!=(a=c.money)?a:0,img:x(f),alt:v}),p("discussionCount")&&D.push({name:h,value:null!=(n=c.discussionCount)?n:0,img:S,alt:h}),p("commentCount")&&D.push({name:d,value:null!=(r=c.commentCount)?r:0,img:M,alt:d}),p("followingCount")&&D.push({name:g,value:null!=(o=c.followingCount)?o:0,img:E,alt:g}),p("followerCount")&&D.push({name:w,value:null!=(s=c.followerCount)?s:0,img:A,alt:w}),p("exp")&&D.push({name:"EXP",value:null!=(i=c.exp)?i:0,img:N,alt:"EXP"}),m("div",{className:"show-stats-wrapper"},m("div",{className:"user-stats-fe show-stats-container"},D.map((function(t){return m(y,{name:t.name,img:t.img,alt:t.alt,value:t.value})})),this.userStat.data&&this.userStat.data.map((function(t){var a=l.userStat&&l.userStat.included.find((function(a){return a.id.toString()===t.attributes.baseStatId.toString()})),n=a?a.attributes.img:"";return m(y,{name:null==a?void 0:a.attributes.name,img:n,alt:null==a?void 0:a.attributes.name,value:t.attributes.value,onclick:function(){b&&l.openEditModal(t,a,l.attrs.user)}})}))))},n.openEditModal=function(t,a,n){e().modal.show(d,{stat:t,baseStat:a,user:n,editUserStat:this.editUserStat.bind(this)})},n.editUserStat=function(t,a){e().request({method:"PATCH",url:e().forum.attribute("apiUrl")+"/user-stats/"+t,body:{data:{attributes:{value:Number(a)}}}}).then((function(){e().alerts.show({type:"success"},e().translator.trans("justoverclock-stats.forum.successStatEdited"))}))},n.getUserStat=function(){var t=this;e().request({method:"GET",url:e().forum.attribute("apiUrl")+"/user-stats/"+this.attrs.user.data.id}).then((function(a){t.userStat=a,m.redraw()}))},a}(c()),H=function(t){function a(){return t.apply(this,arguments)||this}l(a,t);var n=a.prototype;return n.className=function(){return"stats-modal"},n.title=function(){return""},n.content=function(){return m("div",{className:"edit-stat-modal-container"},m(D,{user:this.attrs.user}))},a}(f()),j=function(t){function a(){return t.apply(this,arguments)||this}l(a,t);var n=a.prototype;return n.oninit=function(a){t.prototype.oninit.call(this,a)},n.openModal=function(){e().modal.show(H,{user:this.attrs.user})},n.view=function(t){var a=this;return m("div",{className:"stats-btn-popover"},m("div",{className:"stats-svg",onclick:function(){return a.openModal()}},m("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",id:"statistic"},m("path",{fill:"#4D698E",d:"M29,10V22a5.021,5.021,0,0,1-.3,1.7,5.084,5.084,0,0,1-1.99,2.51A5,5,0,0,1,24,27H8a5,5,0,0,1-5-5V10a5,5,0,0,1,.79-2.71A5.084,5.084,0,0,1,6.3,5.3,5.021,5.021,0,0,1,8,5H24A5,5,0,0,1,29,10Z"}),m("path",{fill:"#4D698E",d:"M29,10V22a5.021,5.021,0,0,1-.3,1.7A4.788,4.788,0,0,1,27,24H11a5,5,0,0,1-5-5V7a4.788,4.788,0,0,1,.3-1.7A5.021,5.021,0,0,1,8,5H24A5,5,0,0,1,29,10Z"}),m("path",{fill:"#4D698E",d:"M24,27H8a5.006,5.006,0,0,1-5-5V10A5.006,5.006,0,0,1,8,5H24a5.006,5.006,0,0,1,5,5V22A5.006,5.006,0,0,1,24,27ZM8,7a3,3,0,0,0-3,3V22a3,3,0,0,0,3,3H24a3,3,0,0,0,3-3V10a3,3,0,0,0-3-3Z"}),m("path",{fill:"#fff",d:"M16 22.5A1.5 1.5 0 0114.5 21V11a1.5 1.5 0 013 0V21A1.5 1.5 0 0116 22.5zM10 22.5A1.5 1.5 0 018.5 21V15a1.5 1.5 0 013 0v6A1.5 1.5 0 0110 22.5zM22 22.5A1.5 1.5 0 0120.5 21V13a1.5 1.5 0 013 0v8A1.5 1.5 0 0122 22.5z"}))))},a}(c());e().initializers.add("justoverclock/stats",(function(){(0,s.extend)(o().prototype,"view",(function(t){var a=t.children[0].children[0].children[1].children;console.log(a),a.push(m(j,{user:this.attrs.user}))}))}))})(),module.exports={}})();
//# sourceMappingURL=forum.js.map