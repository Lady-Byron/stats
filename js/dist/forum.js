(()=>{var t={n:a=>{var o=a&&a.__esModule?()=>a.default:()=>a;return t.d(o,{a:o}),o},d:(a,o)=>{for(var n in o)t.o(o,n)&&!t.o(a,n)&&Object.defineProperty(a,n,{enumerable:!0,get:o[n]})},o:(t,a)=>Object.prototype.hasOwnProperty.call(t,a)};(()=>{"use strict";const a=flarum.core.compat["common/app"];t.n(a)().initializers.add("justoverclock/stats",(function(){console.log("[justoverclock/stats] Hello, forum and admin!")}));const o=flarum.core.compat["forum/app"];var n=t.n(o);const e=flarum.core.compat["forum/components/UserCard"];var r=t.n(e);const s=flarum.core.compat["common/extend"];function i(t,a){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,a){return t.__proto__=a,t},i(t,a)}function u(t,a){t.prototype=Object.create(a.prototype),t.prototype.constructor=t,i(t,a)}const l=flarum.core.compat["common/Component"];var c=t.n(l);const f=flarum.core.compat["common/components/Modal"];var d=t.n(f);const p=flarum.core.compat["common/utils/Stream"];var v=t.n(p),h=function(t){function a(){for(var a,o=arguments.length,n=new Array(o),e=0;e<o;e++)n[e]=arguments[e];return(a=t.call.apply(t,[this].concat(n))||this).value=v()(""),a}u(a,t);var o=a.prototype;return o.className=function(){return"stat-modal-edit"},o.title=function(){return""+this.attrs.baseStat.attributes.name},o.content=function(){var t=this,a=this.attrs.baseStat.attributes.name,o=this.attrs.user.displayName();return m("div",{className:"edit-stat-modal-container"},m("h3",null,'Set "',a,'" for ',o),m("input",{className:"FormControl",name:a,placeholder:n().translator.trans("justoverclock-stats.forum.editStatInputPlaceholder"),type:"text",oninput:function(a){return t.value(a.target.value)}}),m("button",{onclick:function(a){a.preventDefault(),t.attrs.editUserStat(t.attrs.stat.id,t.value()),t.hide()},className:"Button Button--primary"},n().translator.trans("justoverclock-stats.forum.save")))},a}(d());const y=flarum.core.compat["common/components/Tooltip"];var b=t.n(y),w=function(t){function a(){return t.apply(this,arguments)||this}u(a,t);var o=a.prototype;return o.oninit=function(a){t.prototype.oninit.call(this,a)},o.view=function(){var t=this.attrs,a=t.name,o=t.icon,n=t.value,e=t.onclick;return m("div",{className:"stat",onclick:function(){return e&&e()}},m("div",{className:"stat-value"},m(b(),{text:a},m("i",{class:o,"aria-label":a,role:"img"})),m("p",{className:"stat-desc"},a),m("p",{className:"statvalue"},String(n))))},a}(c()),S=function(t){function a(){for(var a,o=arguments.length,n=new Array(o),e=0;e<o;e++)n[e]=arguments[e];return(a=t.call.apply(t,[this].concat(n))||this).userStat=null,a}u(a,t);var o=a.prototype;return o.oninit=function(a){t.prototype.oninit.call(this,a),this.userStat=null,this.getUserStat()},o.view=function(){var t,a,o,e,r,s=this;if(!this.userStat)return m("div",null);var i=this.attrs.user.data,u=i&&i.attributes||{},l=function(t){return Object.prototype.hasOwnProperty.call(u,t)},c=n().translator.trans("justoverclock-stats.forum.moneyName")||"Money",f=!!u.canEditStats;return m("div",{className:"show-stats-wrapper"},m("div",{className:"user-stats-fe show-stats-container"},l("money")&&m(w,{name:c,icon:"fa-duotone fa-solid fa-coin-front",value:null!=(t=u.money)?t:0}),l("discussionCount")&&m(w,{name:"Topics",icon:"fa-duotone fa-solid fa-message-smile",value:null!=(a=u.discussionCount)?a:0}),l("commentCount")&&m(w,{name:"Replies",icon:"fa-duotone fa-solid fa-message-heart",value:null!=(o=u.commentCount)?o:0}),l("followingCount")&&m(w,{name:"Following",icon:"fa-duotone fa-solid fa-person-dress-fairy",value:null!=(e=u.followingCount)?e:0}),l("followerCount")&&m(w,{name:"Followers",icon:"fa-duotone fa-solid fa-head-side-heart",value:null!=(r=u.followerCount)?r:0}),this.userStat.data&&this.userStat.data.map((function(t){var a=s.userStat&&s.userStat.included.find((function(a){return a.id.toString()===t.attributes.baseStatId.toString()})),o=(null==a?void 0:a.attributes.name)||"",n=t.attributes.value;return m(w,{name:o,icon:"fa-duotone fa-chart-simple",value:n,onclick:function(){f&&s.openEditModal(t,a,s.attrs.user)}})}))))},o.openEditModal=function(t,a,o){n().modal.show(h,{stat:t,baseStat:a,user:o,editUserStat:this.editUserStat.bind(this)})},o.editUserStat=function(t,a){n().request({method:"PATCH",url:n().forum.attribute("apiUrl")+"/user-stats/"+t,body:{data:{attributes:{value:Number(a)}}}}).then((function(){n().alerts.show({type:"success"},n().translator.trans("justoverclock-stats.forum.successStatEdited"))}))},o.getUserStat=function(){var t=this;n().request({method:"GET",url:n().forum.attribute("apiUrl")+"/user-stats/"+this.attrs.user.data.id}).then((function(a){t.userStat=a,m.redraw()}))},a}(c()),g=function(t){function a(){return t.apply(this,arguments)||this}u(a,t);var o=a.prototype;return o.className=function(){return"stats-modal"},o.title=function(){return""},o.content=function(){return m("div",{className:"edit-stat-modal-container"},m(S,{user:this.attrs.user}))},a}(d()),A=function(t){function a(){return t.apply(this,arguments)||this}u(a,t);var o=a.prototype;return o.oninit=function(a){t.prototype.oninit.call(this,a)},o.openModal=function(){n().modal.show(g,{user:this.attrs.user})},o.view=function(t){var a=this;return m("div",{className:"stats-btn-popover"},m("div",{className:"stats-svg",onclick:function(){return a.openModal()}},m("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",id:"statistic"},m("path",{fill:"#4D698E",d:"M29,10V22a5.021,5.021,0,0,1-.3,1.7,5.084,5.084,0,0,1-1.99,2.51A5,5,0,0,1,24,27H8a5,5,0,0,1-5-5V10a5,5,0,0,1,.79-2.71A5.084,5.084,0,0,1,6.3,5.3,5.021,5.021,0,0,1,8,5H24A5,5,0,0,1,29,10Z"}),m("path",{fill:"#4D698E",d:"M29,10V22a5.021,5.021,0,0,1-.3,1.7A4.788,4.788,0,0,1,27,24H11a5,5,0,0,1-5-5V7a4.788,4.788,0,0,1,.3-1.7A5.021,5.021,0,0,1,8,5H24A5,5,0,0,1,29,10Z"}),m("path",{fill:"#4D698E",d:"M24,27H8a5.006,5.006,0,0,1-5-5V10A5.006,5.006,0,0,1,8,5H24a5.006,5.006,0,0,1,5,5V22A5.006,5.006,0,0,1,24,27ZM8,7a3,3,0,0,0-3,3V22a3,3,0,0,0,3,3H24a3,3,0,0,0,3-3V10a3,3,0,0,0-3-3Z"}),m("path",{fill:"#fff",d:"M16 22.5A1.5 1.5 0 0114.5 21V11a1.5 1.5 0 013 0V21A1.5 1.5 0 0116 22.5zM10 22.5A1.5 1.5 0 018.5 21V15a1.5 1.5 0 013 0v6A1.5 1.5 0 0110 22.5zM22 22.5A1.5 1.5 0 0120.5 21V13a1.5 1.5 0 013 0v8A1.5 1.5 0 0122 22.5z"}))))},a}(c());n().initializers.add("justoverclock/stats",(function(){(0,s.extend)(r().prototype,"view",(function(t){var a=t.children[0].children[0].children[1].children;console.log(a),a.push(m(A,{user:this.attrs.user}))}))}))})(),module.exports={}})();
//# sourceMappingURL=forum.js.map