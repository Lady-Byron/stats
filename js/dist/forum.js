(()=>{var t={n:r=>{var n=r&&r.__esModule?()=>r.default:()=>r;return t.d(n,{a:n}),n},d:(r,n)=>{for(var e in n)t.o(n,e)&&!t.o(r,e)&&Object.defineProperty(r,e,{enumerable:!0,get:n[e]})},o:(t,r)=>Object.prototype.hasOwnProperty.call(t,r)};(()=>{"use strict";const r=flarum.core.compat["common/app"];t.n(r)().initializers.add("justoverclock/stats",(function(){console.log("[justoverclock/stats] Hello, forum and admin!")}));const n=flarum.core.compat["forum/app"];var e=t.n(n);const a=flarum.core.compat["common/extend"],o=flarum.core.compat["forum/components/UserCard"];var s=t.n(o);function i(t,r){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},i(t,r)}function u(t,r){t.prototype=Object.create(r.prototype),t.prototype.constructor=t,i(t,r)}const l=flarum.core.compat["common/Component"];var c=t.n(l);const f=flarum.core.compat["common/components/Modal"];var d=t.n(f);const p=flarum.core.compat["common/utils/Stream"];var v=t.n(p),h=function(t){function r(){for(var r,n=arguments.length,e=new Array(n),a=0;a<n;a++)e[a]=arguments[a];return(r=t.call.apply(t,[this].concat(e))||this).value=v()(""),r}u(r,t);var n=r.prototype;return n.className=function(){return"stat-modal-edit"},n.title=function(){return""+this.attrs.baseStat.attributes.name},n.content=function(){var t=this,r=this.attrs.baseStat.attributes.name,n=this.attrs.user.displayName();return m("div",{className:"edit-stat-modal-container"},m("h3",null,'Set "',r,'" for ',n),m("input",{className:"FormControl",name:r,placeholder:e().translator.trans("justoverclock-stats.forum.editStatInputPlaceholder"),type:"text",oninput:function(r){return t.value(r.target.value)}}),m("button",{onclick:function(r){r.preventDefault(),t.attrs.editUserStat(t.attrs.stat.id,t.value()),t.hide()},className:"Button Button--primary"},e().translator.trans("justoverclock-stats.forum.save")))},r}(d());const y=flarum.core.compat["common/components/Tooltip"];var b=t.n(y),S=function(t){function r(){return t.apply(this,arguments)||this}u(r,t);var n=r.prototype;return n.oninit=function(r){t.prototype.oninit.call(this,r)},n.view=function(){var t=this.attrs,r=t.name,n=t.icon,e=t.value,a=t.onclick;return m("div",{className:"stat",onclick:function(){return a&&a()}},m("div",{className:"stat-value"},m(b(),{text:r},m("i",{class:n,"aria-label":r,role:"img"})),m("p",{className:"stat-desc"},r),m("p",{className:"statvalue"},String(e))))},r}(c()),g=function(t){function r(){for(var r,n=arguments.length,e=new Array(n),a=0;a<n;a++)e[a]=arguments[a];return(r=t.call.apply(t,[this].concat(e))||this).userStat=null,r}u(r,t);var n=r.prototype;return n.oninit=function(r){t.prototype.oninit.call(this,r),this.userStat=null,this.getUserStat()},n.view=function(){var t,r,n,a,o,s=this;if(!this.userStat)return m("div",null);var i=this.attrs.user.data,u=i&&i.attributes||{},l=function(t){return Object.prototype.hasOwnProperty.call(u,t)},c=e().translator.trans("justoverclock-stats.forum.moneyName"),f=e().translator.trans("justoverclock-stats.forum.topics"),d=e().translator.trans("justoverclock-stats.forum.replies"),p=e().translator.trans("justoverclock-stats.forum.following"),v=e().translator.trans("justoverclock-stats.forum.followers"),h=!!u.canEditStats;return m("div",{className:"show-stats-wrapper"},m("div",{className:"user-stats-fe show-stats-container"},l("money")&&m(S,{name:c,icon:"fa-duotone fa-solid fa-coin-front",value:null!=(t=u.money)?t:0}),l("discussionCount")&&m(S,{name:f,icon:"fa-duotone fa-solid fa-message-smile",value:null!=(r=u.discussionCount)?r:0}),l("commentCount")&&m(S,{name:d,icon:"fa-duotone fa-solid fa-message-heart",value:null!=(n=u.commentCount)?n:0}),l("followingCount")&&m(S,{name:p,icon:"fa-duotone fa-solid fa-person-dress-fairy",value:null!=(a=u.followingCount)?a:0}),l("followerCount")&&m(S,{name:v,icon:"fa-duotone fa-solid fa-head-side-heart",value:null!=(o=u.followerCount)?o:0}),this.userStat.data&&this.userStat.data.map((function(t){var r=s.userStat&&s.userStat.included.find((function(r){return r.id.toString()===t.attributes.baseStatId.toString()})),n=(null==r?void 0:r.attributes.name)||"",e=t.attributes.value;return m(S,{name:n,icon:"fa-duotone fa-chart-simple",value:e,onclick:function(){h&&s.openEditModal(t,r,s.attrs.user)}})}))))},n.openEditModal=function(t,r,n){e().modal.show(h,{stat:t,baseStat:r,user:n,editUserStat:this.editUserStat.bind(this)})},n.editUserStat=function(t,r){e().request({method:"PATCH",url:e().forum.attribute("apiUrl")+"/user-stats/"+t,body:{data:{attributes:{value:Number(r)}}}}).then((function(){e().alerts.show({type:"success"},e().translator.trans("justoverclock-stats.forum.successStatEdited"))}))},n.getUserStat=function(){var t=this;e().request({method:"GET",url:e().forum.attribute("apiUrl")+"/user-stats/"+this.attrs.user.data.id}).then((function(r){t.userStat=r,m.redraw()}))},r}(c()),w=function(t){function r(){return t.apply(this,arguments)||this}u(r,t);var n=r.prototype;return n.className=function(){return"stats-modal"},n.title=function(){return""},n.content=function(){return m("div",{className:"edit-stat-modal-container"},m(g,{user:this.attrs.user}))},r}(d()),j=function(t){function r(){return t.apply(this,arguments)||this}u(r,t);var n=r.prototype;return n.oninit=function(r){t.prototype.oninit.call(this,r)},n.openModal=function(){e().modal.show(w,{user:this.attrs.user})},n.view=function(){var t=this;return m("div",{className:"stats-btn-popover",onclick:function(){return t.openModal()},"aria-label":"Open stats",role:"button",tabindex:"0",onkeydown:function(r){"Enter"!==r.key&&" "!==r.key||t.openModal()}},m("i",{class:"fa-duotone fa-solid fa-star-shooting","aria-hidden":"true"}))},r}(c());function k(t,r){(null==r||r>t.length)&&(r=t.length);for(var n=0,e=Array(r);n<r;n++)e[n]=t[n];return e}function N(t,r){var n,e;if(!t)return null;var a=(null==(n=t.attrs)?void 0:n.className)||(null==(e=t.attrs)?void 0:e.class)||"";if("string"==typeof a&&a.includes(r))return t;for(var o,s=function(t,r){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=function(t,r){if(t){if("string"==typeof t)return k(t,r);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?k(t,r):void 0}}(t))||r&&t&&"number"==typeof t.length){n&&(t=n);var e=0;return function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(Array.isArray(t.children)?t.children:[]);!(o=s()).done;){var i=N(o.value,r);if(i)return i}return null}e().initializers.add("justoverclock/stats",(function(){(0,a.extend)(s().prototype,"view",(function(t){var r=N(t,"UserCard-avatar");r&&Array.isArray(r.children)&&r.children.push(m(j,{user:this.attrs.user}))}))}))})(),module.exports={}})();
//# sourceMappingURL=forum.js.map