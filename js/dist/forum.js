(()=>{var t={n:a=>{var e=a&&a.__esModule?()=>a.default:()=>a;return t.d(e,{a:e}),e},d:(a,e)=>{for(var r in e)t.o(e,r)&&!t.o(a,r)&&Object.defineProperty(a,r,{enumerable:!0,get:e[r]})},o:(t,a)=>Object.prototype.hasOwnProperty.call(t,a)};(()=>{"use strict";const a=flarum.core.compat["common/app"];t.n(a)().initializers.add("justoverclock/stats",(function(){console.log("[justoverclock/stats] Hello, forum and admin!")}));const e=flarum.core.compat["forum/app"];var r=t.n(e);const o=flarum.core.compat["forum/components/UserCard"];var s=t.n(o);const n=flarum.core.compat["common/extend"];function i(t,a){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,a){return t.__proto__=a,t},i(t,a)}function u(t,a){t.prototype=Object.create(a.prototype),t.prototype.constructor=t,i(t,a)}const c=flarum.core.compat["common/Component"];var l=t.n(c);const p=flarum.core.compat["common/components/LoadingIndicator"];var d=t.n(p);const f=flarum.core.compat["common/components/Modal"];var v=t.n(f);const h=flarum.core.compat["common/utils/Stream"];var b=t.n(h),y=function(t){function a(){for(var a,e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];return(a=t.call.apply(t,[this].concat(r))||this).value=b()(""),a}u(a,t);var e=a.prototype;return e.className=function(){return"stat-modal-edit"},e.title=function(){return""+this.attrs.baseStat.attributes.name},e.content=function(){var t=this,a=this.attrs.baseStat.attributes.name,e=this.attrs.user.displayName();return m("div",{className:"edit-stat-modal-container"},m("h3",null,'Set "',a,'" for ',e),m("input",{className:"FormControl",name:a,placeholder:r().translator.trans("justoverclock-stats.forum.editStatInputPlaceholder"),type:"text",oninput:function(a){return t.value(a.target.value)}}),m("button",{onclick:function(a){a.preventDefault(),t.attrs.editUserStat(t.attrs.stat.id,t.value()),t.hide()},className:"Button Button--primary"},r().translator.trans("justoverclock-stats.forum.save")))},a}(v());const S=flarum.core.compat["common/components/Tooltip"];var g=t.n(S),j=function(t){function a(){return t.apply(this,arguments)||this}u(a,t);var e=a.prototype;return e.oninit=function(a){t.prototype.oninit.call(this,a)},e.view=function(t){var a=this;return m("div",{className:"stat",onclick:function(){a.attrs.onclick&&a.attrs.onclick()}},m("div",{className:"stat-value"},m(g(),{text:this.attrs.name},m("img",{src:this.attrs.img,alt:this.attrs.alt})),m("p",{className:"stat-desc"},this.attrs.name),m("p",{class:"statvalue"},this.attrs.value)))},a}(l()),k=function(t){function a(){for(var a,e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];return(a=t.call.apply(t,[this].concat(r))||this).userStat=null,a}u(a,t);var e=a.prototype;return e.oninit=function(a){t.prototype.oninit.call(this,a),this.userStat=null,this.getUserStat()},e.view=function(t){var a,e,o,s=this;if(!this.userStat)return m(d(),null);var n=this.attrs.user.data,i=r().forum.attribute("antoinefr-money.moneyname")||"[money]",u=r().translator.trans("justoverclock-stats.forum.storyCount"),c=null!=(a=n.attributes.money)?a:0,l=null!=(e=n.attributes.storyCount)?e:0,p=r().forum.attribute("baseUrl")+"/assets/extensions/justoverclock-stats/money1.png",f=r().forum.attribute("baseUrl")+"/assets/extensions/justoverclock-stats/storiespng.png",v=null==(o=n.attributes)?void 0:o.canEditStats;return m("div",{className:"show-stats-wrapper"},m("div",{className:"user-stats-fe container show-stats-container"},m(j,{name:i,img:r().forum.attribute("justoverclock-stats.moneyImg")||p,alt:i,value:c}),m(j,{name:u,img:r().forum.attribute("justoverclock-stats.storiesImg")||f,alt:u,value:l}),this.userStat.data&&this.userStat.data.map((function(t){var a=s.userStat&&s.userStat.included.find((function(a){return a.id.toString()===t.attributes.baseStatId.toString()})),e=a?a.attributes.img:"";return m(j,{name:null==a?void 0:a.attributes.name,img:e,alt:null==a?void 0:a.attributes.name,value:t.attributes.value,onclick:function(){v&&s.openEditModal(t,a,s.attrs.user)}})}))))},e.openEditModal=function(t,a,e){r().modal.show(y,{stat:t,baseStat:a,user:e,editUserStat:this.editUserStat.bind(this)})},e.editUserStat=function(t,a){r().request({method:"PATCH",url:r().forum.attribute("apiUrl")+"/user-stats/"+t,body:{data:{attributes:{value:Number(a)}}}}).then((function(){r().alerts.show({type:"success"},r().translator.trans("justoverclock-stats.forum.successStatEdited"))}))},e.getUserStat=function(){var t=this;r().request({method:"GET",url:r().forum.attribute("apiUrl")+"/user-stats/"+this.attrs.user.data.id}).then((function(a){t.userStat=a,m.redraw()}))},a}(l());r().initializers.add("justoverclock/stats",(function(){(0,n.extend)(s().prototype,"view",(function(t){t.children&&t.children.splice&&t.children.splice(1,0,m(k,{user:this.attrs.user}))}))}))})(),module.exports={}})();
//# sourceMappingURL=forum.js.map